schema: '2.0'
stages:
  ingest:
    cmd: .venv/bin/python age_gender/data_ingest.py
    deps:
    - path: age_gender/data_ingest.py
      hash: md5
      md5: b826204a8e1410ef51f5ce9bb62c21ee
      size: 1671
    - path: data/raw/utkface_aligned_cropped/UTKFace
      hash: md5
      md5: 69f82d6acb3b8cdbbc77d5d67523b077.dir
      size: 119986277
      nfiles: 23708
    outs:
    - path: data/processed/utkface_metadata.csv
      hash: md5
      md5: e7a834df8dad780a0e30674998f158b8
      size: 1060691
  validate:
    cmd: python age_gender/data_validate.py
    deps:
    - path: age_gender/data_validate.py
      hash: md5
      md5: 994f439243b531bab953c1760a1a2fb8
      size: 1952
    - path: data/processed/utkface_metadata.csv
      hash: md5
      md5: e7a834df8dad780a0e30674998f158b8
      size: 1060691
    - path: data/raw/utkface_aligned_cropped/UTKFace
      hash: md5
      md5: 69f82d6acb3b8cdbbc77d5d67523b077.dir
      size: 119986277
      nfiles: 23708
    outs:
    - path: data/processed/validation
      hash: md5
      md5: 33c12295d53e37d7ab0790e1a64ed46f.dir
      size: 104
      nfiles: 1
  split:
    cmd: .venv/bin/python age_gender/data_split.py
    deps:
    - path: age_gender/data_split.py
      hash: md5
      md5: f4867ae815d560388386ee084105f2f1
      size: 1394
    - path: data/processed/utkface_metadata.csv
      hash: md5
      md5: e7a834df8dad780a0e30674998f158b8
      size: 1060691
    outs:
    - path: data/processed/splits
      hash: md5
      md5: 1dbf57f1b4ecc5acd0d5e4b3cbaa2f2c.dir
      size: 1060741
      nfiles: 3
  train:
    cmd: python age_gender/train.py
    deps:
    - path: age_gender/train.py
      hash: md5
      md5: 1c977c4e221b9143a6477f0683909368
      size: 5428
    - path: data/processed/splits/train.csv
      hash: md5
      md5: 7a4582038dd111ed2d0d8f44b71a50ef
      size: 742487
    - path: data/processed/splits/val.csv
      hash: md5
      md5: 43d7de3c2b83502a33d4a408581f1ac0
      size: 159118
    outs:
    - path: models/age_model.pt
      hash: md5
      md5: 2f7bc51bdc35518cafaa7df9eacf87f4
      size: 9146315
    - path: models/gender_model.pt
      hash: md5
      md5: 0615289ebc3a1f5ab230c4bf69b390a6
      size: 9152395
  eval:
    cmd: python age_gender/eval.py
    deps:
    - path: age_gender/eval.py
      hash: md5
      md5: 16569398ab1b05e758f8442b31a9a76c
      size: 4024
    - path: data/processed/splits/val.csv
      hash: md5
      md5: 43d7de3c2b83502a33d4a408581f1ac0
      size: 159118
    - path: models/age_model.pt
      hash: md5
      md5: 2f7bc51bdc35518cafaa7df9eacf87f4
      size: 9146315
    - path: models/gender_model.pt
      hash: md5
      md5: 0615289ebc3a1f5ab230c4bf69b390a6
      size: 9152395
    outs:
    - path: models/evaluation
      hash: md5
      md5: 2fdfd666034c085ccb3cc1f712083406.dir
      size: 186
      nfiles: 1
  register_model:
    cmd: "export MLFLOW_RUN_ID=$(cat mlflow_run_id.txt | grep 'MLFLOW_RUN_ID:' | cut
      -d ':' -f 2) \npython mlops_xoxo/register_model.py \n"
    deps:
    - path: mlops_xoxo/register_model.py
      hash: md5
      md5: c69544e33847fcd7e0da839fa8018fff
      size: 1666
    - path: models/face_embedding
      hash: md5
      md5: 259e0943e4e53c7197d650ac66804295.dir
      size: 11776372
      nfiles: 1
    params:
      params.yaml:
        training:
          batch_size: 64
          device: mps
          embedding_size: 512
          epochs: 10
          lr: 0.0001
          margin: 0.2
          weight_decay: 0.0001
  face_embedding_pipeline:
    cmd: dvc repro pipelines/face_embedding/dvc.yaml
  face_classification_pipeline:
    cmd: dvc repro pipelines/fake_classification/dvc.yaml
  fake_classification_pipeline:
    cmd: dvc repro pipelines/fake_classification/dvc.yaml
