schema: '2.0'
stages:
  ingest:
    cmd: python mlops_xoxo/data_ingest.py
    deps:
    - path: data/external/casioface/train.idx
      hash: md5
      md5: 0b4801a39ba6237c891dcfb777eeb295
      size: 8707814
    - path: data/external/casioface/train.lst
      hash: md5
      md5: 99d49349533309391272473538054a0d
      size: 73167925
    - path: data/external/casioface/train.rec
      hash: md5
      md5: 459c18fd8152cc1d4a9484c3f0713d19
      size: 2726043620
    - path: mlops_xoxo/data_ingest.py
      hash: md5
      md5: 4e38caa49f7da7685373d6fcb7b61fbb
      size: 435
    outs:
    - path: data/raw
      hash: md5
      md5: 560985c1fe22c75212e70058f38e54cf.dir
      size: 54198793
      nfiles: 10000
  validate:
    cmd: python mlops_xoxo/data_validate.py
    deps:
    - path: data/raw
      hash: md5
      md5: 560985c1fe22c75212e70058f38e54cf.dir
      size: 54198793
      nfiles: 10000
    - path: mlops_xoxo/data_validate.py
      hash: md5
      md5: 6732642e41a6f0a2251ea535eb078f4a
      size: 2378
    outs:
    - path: docs
      hash: md5
      md5: e35169b16cffac93df180700298927d1.dir
      size: 194
      nfiles: 1
  split:
    cmd: python mlops_xoxo/data_split.py
    deps:
    - path: data/raw
      hash: md5
      md5: 560985c1fe22c75212e70058f38e54cf.dir
      size: 54198793
      nfiles: 10000
    - path: mlops_xoxo/data_split.py
      hash: md5
      md5: 326d81faeaf6d88d2955cb927555c3d2
      size: 1239
    outs:
    - path: data/processed
      hash: md5
      md5: c7fab794166c9b567de58a74b675c6b8.dir
      size: 54527737
      nfiles: 10001
  train:
    cmd: python mlops_xoxo/train.py > mlflow_run_id.txt
    deps:
    - path: data/processed/train
      hash: md5
      md5: 0a9f6f571f5c2351087a0e3321a3d058.dir
      size: 37825416
      nfiles: 6974
    - path: mlops_xoxo/train.py
      hash: md5
      md5: 372f95ae3d93da82a1b509f0ad996142
      size: 9852
    - path: params.yaml
      hash: md5
      md5: b40ded7029e65c7a7fe732209334a71f
      size: 602
    params:
      params.yaml:
        training:
          batch_size: 64
          device: mps
          embedding_size: 512
          epochs: 20
          lr: 0.0001
          margin: 0.2
          weight_decay: 0.0001
    outs:
    - path: models/face_embedding
      hash: md5
      md5: 0903b4e98423d3b0c5a8300e92b99747.dir
      size: 11772408
      nfiles: 1
  eval:
    cmd: python mlops_xoxo/eval.py
    deps:
    - path: data/processed/val
      hash: md5
      md5: f51b33ab25a5807cb008e45f3edf3992.dir
      size: 10721750
      nfiles: 1975
    - path: mlops_xoxo/eval.py
      hash: md5
      md5: 661bb8a861910b3142ecba758ea19304
      size: 3339
    - path: models/face_embedding
      hash: md5
      md5: 233cdc73ea08e726192aefd2f5f1666f.dir
      size: 112011117
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 0ebcf7c7b2e3f7204b2ebef4b763ab17
      size: 531
    outs:
    - path: reports
      hash: md5
      md5: 08bfb1679067bf0561a55bdb50f09856.dir
      size: 117649
      nfiles: 2
  register_model:
    cmd: "export MLFLOW_RUN_ID=$(cat mlflow_run_id.txt | grep 'MLFLOW_RUN_ID:' | cut
      -d ':' -f 2) \npython mlops_xoxo/register_model.py \n"
    deps:
    - path: mlops_xoxo/register_model.py
      hash: md5
      md5: 12955a2f171dabec296f86ef73915c5a
      size: 1655
    - path: models/face_embedding
      hash: md5
      md5: 233cdc73ea08e726192aefd2f5f1666f.dir
      size: 112011117
      nfiles: 1
    params:
      params.yaml:
        training:
          batch_size: 64
          epochs: 20
          lr: 0.0001
          embedding_size: 512
          margin: 0.2
          weight_decay: 0.0001
          device: mps
