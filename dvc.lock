schema: '2.0'
stages:
  ingest:
    cmd: python mlops_xoxo/data_ingest.py
    deps:
    - path: data/external/casioface/train.idx
      hash: md5
      md5: 0b4801a39ba6237c891dcfb777eeb295
      size: 8707814
    - path: data/external/casioface/train.lst
      hash: md5
      md5: 99d49349533309391272473538054a0d
      size: 73167925
    - path: data/external/casioface/train.rec
      hash: md5
      md5: 459c18fd8152cc1d4a9484c3f0713d19
      size: 2726043620
    - path: mlops_xoxo/data_ingest.py
      hash: md5
      md5: 0178565d2db38e8391a153710e3a0095
      size: 435
    outs:
    - path: data/raw
      hash: md5
      md5: 560985c1fe22c75212e70058f38e54cf.dir
      size: 54198793
      nfiles: 10000
  validate:
    cmd: python mlops_xoxo/data_validate.py
    deps:
    - path: data/raw
      hash: md5
      md5: 560985c1fe22c75212e70058f38e54cf.dir
      size: 54198793
      nfiles: 10000
    - path: mlops_xoxo/data_validate.py
      hash: md5
      md5: 1c5789c1633d13db7ad3df126e977ce4
      size: 2739
    outs:
    - path: docs
      hash: md5
      md5: 96ee1fbc4eac3fe8b2a34f605fc229bd.dir
      size: 229
      nfiles: 1
  split:
    cmd: python mlops_xoxo/data_split.py
    deps:
    - path: data/raw
      hash: md5
      md5: 560985c1fe22c75212e70058f38e54cf.dir
      size: 54198793
      nfiles: 10000
    - path: mlops_xoxo/data_split.py
      hash: md5
      md5: 606d8bb55310a97f0954609413aea4fe
      size: 2166
    outs:
    - path: data/processed
      hash: md5
      md5: eb3bcf78934442af201df7514f9b90fd.dir
      size: 54642736
      nfiles: 10001
  train:
    cmd: python mlops_xoxo/train.py > mlflow_run_id.txt
    deps:
    - path: data/processed/train
      hash: md5
      md5: 4ac4c8d19815cb820e949cc36854fe55.dir
      size: 37781098
      nfiles: 6974
    - path: mlops_xoxo/train.py
      hash: md5
      md5: cbb9af958d6618721e592322726b9e32
      size: 13609
    - path: params.yaml
      hash: md5
      md5: 59566bb107446af8bd2369a152a141f2
      size: 615
    params:
      params.yaml:
        training:
          batch_size: 64
          device: mps
          embedding_size: 512
          epochs: 3
          lr: 0.0001
          margin: 0.2
          weight_decay: 0.0001
    outs:
    - path: models/face_embedding
      hash: md5
      md5: a549191866b0b505df3ff87c5e4ae67b.dir
      size: 11776372
      nfiles: 1
    - path: reports/emissions.csv
      hash: md5
      md5: 427715e1e610bb7b7fc68173426a38a4
      size: 766
  eval:
    cmd: python mlops_xoxo/eval.py
    deps:
    - path: data/processed/val
      hash: md5
      md5: ac4974dcc1ca0214c2f1850995d16564.dir
      size: 10708305
      nfiles: 1975
    - path: mlops_xoxo/eval.py
      hash: md5
      md5: bc23b922d8346287db9a2facb6f5acda
      size: 5737
    - path: models/face_embedding
      hash: md5
      md5: a549191866b0b505df3ff87c5e4ae67b.dir
      size: 11776372
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 59566bb107446af8bd2369a152a141f2
      size: 615
    outs:
    - path: reports/eval_predictions.json
      hash: md5
      md5: 11f025ce0e270ddccc1ee950e5dd8805
      size: 243717
    - path: reports/eval_summary.txt
      hash: md5
      md5: e9b32f0e2f47d6e60f4e7c382882e16b
      size: 85
  register_model:
    cmd: "export MLFLOW_RUN_ID=$(cat mlflow_run_id.txt | grep 'MLFLOW_RUN_ID:' | cut
      -d ':' -f 2) \npython mlops_xoxo/register_model.py \n"
    deps:
    - path: mlops_xoxo/register_model.py
      hash: md5
      md5: c69544e33847fcd7e0da839fa8018fff
      size: 1666
    - path: models/face_embedding
      hash: md5
      md5: 259e0943e4e53c7197d650ac66804295.dir
      size: 11776372
      nfiles: 1
    params:
      params.yaml:
        training:
          batch_size: 64
          device: mps
          embedding_size: 512
          epochs: 10
          lr: 0.0001
          margin: 0.2
          weight_decay: 0.0001
