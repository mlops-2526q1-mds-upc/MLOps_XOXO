name: Deploy API to Production

on: [push, pull_request]

jobs:
  train:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.13'
    
    - name: Install
      run: |
        pip install torch dvc dvc-http
        pip install -e .
    
    - name: Setup DVC
      env:
        DAGSHUB_USER: ${{ secrets.DAGSHUB_DVC_USER }}
        DAGSHUB_PASS: ${{ secrets.DAGSHUB_DVC_PASS }}
      run: |
        dvc remote modify origin auth basic
        dvc remote modify origin user "$DAGSHUB_USER"
        dvc remote modify origin password "$DAGSHUB_PASS"
    
    - name: Download face embedding data
      run: |
        echo "ðŸ“¥ Downloading face embedding data..."
        
        # Simple download without retry logic
        dvc pull models/face_embedding/mobilenetv2_arcface_model.pth || echo "No pretrained model found"
        dvc pull models/age_gender/age_model.pt || echo "No pretrained model found"
        dvc pull models/age_gender/gender_model.pt || echo "No pretrained model found"
        dvc pull models/emotion_classification/best_model.pth || echo "No pretrained model found"
        dvc pull models/fake_classification/model_best.pth || echo "No pretrained model found"


        echo "âœ… Download completed"
    
    
